---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# BEER Manuscript

This repository contains all of the data and code to reproduce the work presented in, [_Detecting Antibody Reactivities in Phage Immunoprecipitation Sequencing Data_](https://www.biorxiv.org/content/10.1101/2022.01.19.476926v1).

The session info, including all packages used in the analyses and their respective versions can be found in the [Session Info](#session-info) section of this README.md. All code used to generate the figures and tables of the manuscript are mapped in the [section below](#mapping-of-figures-and-tables). The contents of each file in the repository are provided in the [Directory Structure](#directory-structure) section. 

The results in the manuscript were generated using the `R` package [`beer`](https://github.com/athchen/beer) version `0.99.0`.

# Directory structure

### **`analysis`** 

Contains `.Rmd` files that are used to build https://athchen.github.io/beer_manuscript/.

### **`data_processed`**

Generated output used in later parts of the analyses.

* **`coronascan_results.rds`**: PhIPData object with edgeR and BEER results for the CoronaScan data set.
* **`hiv_results.rds`**: PhIPData object with edgeR and BEER results for the HIV EC data set. 
* **`simulation_xbeads_zzzzz`**: folders for the simulation results with `x` beads-only samples and `zzzzz` method of estimating prior parameters for non-enriched peptides in BEER. Each folder has 10 RDS files, each corresponding to one simulated data set. 
* **`simulation_curves.rda`**: objects generated by `R/load_curves.R`. 

### **`data_raw`**

Contains `PhIPData` objects of normalized read counts and relevant sample and peptide annotation for example data sets and code to generate simulated data sets.  

* **`coronascan.rds`**: coronascan data set.
* **`hiv.rds`**: HIV elite controller data set.
* **`hiv_virscan.rds`**: additional HIV data set referenced in the Discussion
* **`simulations.R`**: script to generate simulated data sets. 

### **`docs`**

`.html` files that are used to build https://athchen.github.io/beer_manuscript/. `analysis/xxx.Rmd` generates `docs/xxx.html`.

### **`figures`**

Contains png/pdfs of the manuscript figures. 

### **`R`**

R scripts used to generate the objects in `data_processed` and the figure files in `figures`. 

* **`figure_coronascan.R`** generates figures:
    + `coronascan_protein.png`
    + `coronascan_replicates.png`
    + `coronascan_ranked_prob.png`
* **`figure_hiv.R`** generates figures:
    + `hiv_protein.png`
    + `hiv_protein_noB.png`
    + `hiv_protein_A.png`
    + `hiv_replicates.png`
    + `hiv_ranked_prob.png`
* **`figure_simulation_curves.R`** generates tables `simulation_auc_roc_interp` and `simulation_ppv_by_sens` and figures:
    + `simulation_roc_prc_interp.png`
    + `simulation_roc_prc_interp_all.png`
    + `simulation_roc_prc.png`
    + `simulation_roc_bybeads.png`
    + `simulation_prc_bybeads.png`
* **`figure_simulation_fc.R`** generates figure `simulation_fc.png`.
* **`figure_simulation_logistic.R`** generates figures:
    + `simulation_logistic_fc.png`
    + `simulation_logistic_rc.png`
* **`figure_simulation_postprob.R`** generates figure `simulation_postprob.png`.
* **`helper_functions.R`** contains helper functions for processing and analyzing output.
* **`load_curves.R`** contains code to process and calculate sensitivity, specificity, and ppv from the simulation results.
* **`load_packages.R`** code to load required packages and define global color variables. 
* **`load_simulations.R`** contains code to read in and convert simulation results to a tidy dataframe. 
* **`run_coronascan.R`** runs edgeR and BEER on CoronaScan data.
* **`run_hiv.R`** runs edgeR and BEER on HIV EC data.
* **`run_simulations.R`** runs edgeR and BEER on simulated data sets with various beads-only samples and different methods of estimating prior parameters. 

## Mapping of Figures and Tables

### Main Text

* Figure 1 - in `figures/simulation_roc_prc_interp.png`; generated with `R/figure_simulation_curves.R`
* Figure 2 - in `figures/simulation_logistic_fc.png`; generated with `R/figure_simulation_fc.R`
* Figure 3 - in `figures/hiv_protein.png`; generated with `R/figure_hiv.R`

### Supplementary Material

* Table S1 - generated with `R/figure_simulation_curves.R`
* Table S2 - generated with `R/figure_simulation_curves.R`
* Table S3 - generated with `R/figure_hiv.R`
* Table S4 - generated with `R/figure_coronascan.R`
* Figure S1 - in `figures/simulation_roc_prc.png`; generated with `R/figure_simulation_curves.R`
* Figure S2 - in `figures/simulation_roc_bybeads.png`; generated with `R/figure_simulation_curves.R`
* Figure S3 - in `figures/simulation_prc_bybeads.png`; generated with `R/figure_simulation_curves.R`
* Figure S4 - in `figures/simulation_postprob.png`; generated with `R/figure_simulation_postprob.R`
* Figure S5 - in `figures/simulation_fc.png`; generated with `R/figure_simulation_fc.R`
* Figure S6 - in `figures/hiv_protein_noB.png`; generated with `R/figure_hiv.R`
* Figure S7 - in `figures/hiv_protein_A.png`; generated with `R/figure_hiv.R`
* Figure S8 - in `figures/hiv_replicates.png`; generated with `R/figure_hiv.R`
* Figure S9 - in `figures/hiv_ranked_prob.png`; generated with `R/figure_hiv.R`
* Figure S10 - in `figures/coronascan_protein.png`; generated with `R/figure_coronascan.R`
* Figure S11 - in `figures/coronascan_replicates.png`; generated with `R/figure_coronascan.R`
* Figure S12 - in `figures/coronascan_ranked_prob.png`; generated with `R/figure_coronascan.R`
* Figure S13 - in `figures/corstructure.png`; generated with `R/figure_corstructure.R`
* Figure S14 - in `figures/figdatastructurebinom.png`; generated with `R/figure_corstructure.R`
* Figure S15 - in `figures/attnconstant.png`; generated with `R/figure_attnconstant.R`
* Figure 16 - in `figures/prior.pdf`; generated with `R/figure_priors.R`

# Session Info

```{r}
devtools::session_info()
```